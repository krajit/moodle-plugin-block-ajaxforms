<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Emoji Rating Timeline</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      padding-bottom: 200px;
    }

    .rating-footer {
      position: fixed;
      bottom: 0;
      width: 100%;
      background: #fff;
      border-top: 1px solid #ccc;
      z-index: 999;
    }

    .history-strip-container {
      display: flex;
      align-items: center;
      background-color: #f8f9fa;
      border-top: 1px solid #ccc;
      padding: 10px;
      gap: 10px;
    }

    .toggle-btn {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0 5px;
      color: #007bff;
    }

    .history-strip {
      display: flex;
      overflow-x: auto;
      gap: 15px;
      flex: 1;
      align-items: center;
    }

    .history-item {
      text-align: center;
      flex: 0 0 auto;
    }

    .history-item .emoji {
      font-size: 1.8rem;
    }

    .history-item small {
      display: block;
      font-size: 0.75rem;
      color: #666;
    }

    .plus-btn {
      font-size: 2rem;
      background: none;
      border: none;
      cursor: pointer;
      position: relative;
      z-index: 1;
    }

    .emoji-popup {
      position: fixed;
      display: none;
      background: white;
      padding: 10px;
      border: 1px solid #ccc;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      z-index: 9999;
    }

    .emoji-popup.show {
      display: flex;
      gap: 10px;
    }

    .emoji-option {
      font-size: 1.8rem;
      cursor: pointer;
      background: none;
      border: none;
    }
  </style>
</head>
<body>

<div class="container mt-5">
  <h1>My Learning Page</h1>
  <p>This is a sample page that the user can rate.</p>
</div>

<!-- Rating UI -->
<footer class="rating-footer">
  <div class="history-strip-container">
    <!-- Toggle button on left -->
    <button class="toggle-btn" id="toggleOlderBtn">&lt;</button>

    <!-- Emoji history scroll area -->
    <div class="history-strip" id="ratingHistory">
      <!-- Plus button will be appended here -->
      <button class="plus-btn" id="plusBtn">‚ûï</button>
    </div>
  </div>
</footer>

<!-- Emoji selection popup -->
<div class="emoji-popup" id="emojiPopup">
  <button class="emoji-option" data-rating="üò°">üò°</button>
  <button class="emoji-option" data-rating="üòï">üòï</button>
  <button class="emoji-option" data-rating="üòê">üòê</button>
  <button class="emoji-option" data-rating="üôÇ">üôÇ</button>
  <button class="emoji-option" data-rating="üòç">üòç</button>
</div>

<script>
  const plusBtn = document.getElementById('plusBtn');
  const emojiPopup = document.getElementById('emojiPopup');
  const ratingHistory = document.getElementById('ratingHistory');
  const toggleOlderBtn = document.getElementById('toggleOlderBtn');

  const MAX_VISIBLE = 5;
  let allRatings = [
    { rating: "üôÇ", date: "2025-06-25" },
    { rating: "üòê", date: "2025-06-26" },
    { rating: "üòç", date: "2025-06-27" },
    { rating: "üòï", date: "2025-06-28" },
    { rating: "üôÇ", date: "2025-06-29" },
    { rating: "üòç", date: "2025-06-30" },
    { rating: "üò°", date: "2025-07-01" }
  ];
  let showAll = false;

  function renderRatings() {
    ratingHistory.innerHTML = '';

    const ratingsToShow = showAll ? allRatings : allRatings.slice(-MAX_VISIBLE);

    ratingsToShow.forEach(({ rating, date }) => {
      const item = document.createElement('div');
      item.className = 'history-item';
      item.innerHTML = `<div class="emoji">${rating}</div><small>${date}</small>`;
      ratingHistory.appendChild(item);
    });

    // Append plus button at the end
    ratingHistory.appendChild(plusBtn);
  }

  function addNewRating(rating) {
    const today = new Date().toISOString().split('T')[0];
    allRatings.push({ rating, date: today });
    renderRatings();
  }

  plusBtn.addEventListener('click', () => {
    const rect = plusBtn.getBoundingClientRect();
    emojiPopup.style.left = `${rect.left}px`;
    emojiPopup.style.top = `${rect.top - 60}px`;
    emojiPopup.classList.toggle('show');
  });

  document.querySelectorAll('.emoji-option').forEach(button => {
    button.addEventListener('click', () => {
      const rating = button.dataset.rating;
      addNewRating(rating);
      emojiPopup.classList.remove('show');
    });
  });

  toggleOlderBtn.addEventListener('click', () => {
    showAll = !showAll;
    toggleOlderBtn.textContent = showAll ? '-' : '+';
    renderRatings();
  });

  document.addEventListener('click', (e) => {
    if (!emojiPopup.contains(e.target) && e.target !== plusBtn) {
      emojiPopup.classList.remove('show');
    }
  });

  renderRatings();
</script>

</body>
</html>
