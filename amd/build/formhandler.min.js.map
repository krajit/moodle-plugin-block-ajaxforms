{"version":3,"file":"formhandler.min.js","sources":["../src/formhandler.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n    return {\n        init: function(params) {\n            const levelColors = {\n                \"Not Started\": \"#f8d7da\",\n                \"Fresh\": \"#fce5cd\",\n                \"Learning\": \"#fff3cd\",\n                \"Expert\": \"#d1ecf1\",\n                \"Done\": \"#d4edda\"\n            };\n\n            function updateLevelColor() {\n                const levelSelect = document.getElementById('learninglevel');\n                const selectedLevel = levelSelect?.value;\n                if (selectedLevel && levelColors[selectedLevel]) {\n                    levelSelect.style.backgroundColor = levelColors[selectedLevel];\n                } else if (levelSelect) {\n                    levelSelect.style.backgroundColor = 'white';\n                }\n            }\n\n            function updateProgressBar() {\n                const revisionInput = document.getElementById('revisioncount');\n                const targetInput = document.getElementById('targetcount');\n                const progressBar = document.getElementById('progressBar');\n\n                const revisioncount = parseInt(revisionInput?.value || 0);\n                const targetcount = parseInt(targetInput?.value || 1);\n                const percent = Math.min(100, Math.round((revisioncount / targetcount) * 100));\n                if (progressBar) {\n                    progressBar.style.width = percent + '%';\n                    progressBar.textContent = percent + '%';\n                }\n            }\n\n            function saveData() {\n                var date = $('#nextReview').val();\n                const learninglevel = $('#learninglevel').val();\n                const revisioncount = $('#revisioncount').val();\n                const targetcount = $('#targetcount').val();\n                const pageurl = window.location.pathname + window.location.search;\n\n                if (!date) {\n                    date = '';\n                }\n\n                Ajax.call([{\n                    methodname: 'block_revisionmanager_save_entry',\n                    args: {\n                        nextreview: date,\n                        pageurl: pageurl,\n                        courseid: params.courseid,\n                        pagetitle: params.pagetitle,\n                        learninglevel: learninglevel,\n                        revisioncount: revisioncount,\n                        targetcount: targetcount,\n                    },\n                    done: function(response) {\n                        console.log('Saved:', response.status);\n                    },\n                    fail: Notification.exception\n                }]);\n            }\n\n            function loadExistingData() {\n                const pageurl = window.location.pathname + window.location.search;\n\n                Ajax.call([{\n                    methodname: 'block_revisionmanager_get_entry',\n                    args: {\n                        pageurl: pageurl,\n                        courseid: params.courseid\n                    },\n                    done: function(data) {\n                        if (data.nextreview) {\n                            $('#nextReview').val(data.nextreview);\n                        }\n                        if (data.learninglevel) {\n                            $('#learninglevel').val(data.learninglevel);\n                            updateLevelColor();\n                        }\n                        if (data.revisioncount) {\n                            $('#revisioncount').val(data.revisioncount);\n                        }\n                        if (data.targetcount) {\n                            $('#targetcount').val(data.targetcount);\n                        }\n                        updateProgressBar();\n\n                        // TODO: If you return a list of past ratings, render them here\n                        // Example: data.ratings = [{date: '2025-06-30', value: 4}, ...]\n                        // populateRatingGrid(data.ratings);\n                    },\n                    fail: Notification.exception\n                }]);\n            }\n\n            // === RATING SQUARE UI ===\n            const grid = document.getElementById('rating-grid');\n            const plusBtn = document.getElementById('plusBtn');\n            const popup = document.getElementById('rating-popup');\n            const dateInput = document.getElementById('rating-date');\n            const valueInput = document.getElementById('rating-value');\n            const saveBtn = document.getElementById('rating-save');\n\n            plusBtn?.addEventListener('click', (e) => {\n                const rect = plusBtn.getBoundingClientRect();\n                const containerRect = grid.getBoundingClientRect();\n                popup.style.position = 'absolute';\n                popup.style.left = `${rect.left - containerRect.left + grid.scrollLeft}px`;\n                popup.style.top = `${rect.top - containerRect.top + 45}px`;\n                popup.style.display = 'block';\n                dateInput.valueAsDate = new Date();\n                valueInput.value = '';\n            });\n\n            saveBtn?.addEventListener('click', () => {\n                const rating = parseInt(valueInput.value);\n                const date = dateInput.value;\n\n                if (isNaN(rating) || rating < 0 || rating > 5) {\n                    alert(\"Please enter a rating between 0 and 5\");\n                    return;\n                }\n\n                const div = document.createElement('div');\n                div.className = `rating-square bg-rating-${rating}`;\n                div.textContent = rating;\n                div.title = `Date: ${date}`;\n\n                grid.insertBefore(div, plusBtn);\n                popup.style.display = 'none';\n\n                // TODO: Save rating to server\n                console.log(\"Saved rating:\", rating, \"on\", date);\n            });\n\n            document.addEventListener('click', (e) => {\n                if (!popup.contains(e.target) && e.target !== plusBtn) {\n                    popup.style.display = 'none';\n                }\n            });\n\n            // === INIT ===\n            $('#nextReview').on('input change', saveData);\n            $('#learninglevel').on('input change', function() {\n                updateLevelColor();\n                saveData();\n            });\n            $('#revisioncount').on('input change', function() {\n                updateProgressBar();\n                saveData();\n            });\n            $('#targetcount').on('input change', function() {\n                updateProgressBar();\n                saveData();\n            });\n\n            updateLevelColor();\n            updateProgressBar();\n            loadExistingData();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","init","params","levelColors","updateLevelColor","levelSelect","document","getElementById","selectedLevel","value","style","backgroundColor","updateProgressBar","revisionInput","targetInput","progressBar","revisioncount","parseInt","targetcount","percent","Math","min","round","width","textContent","saveData","date","val","learninglevel","pageurl","window","location","pathname","search","call","methodname","args","nextreview","courseid","pagetitle","done","response","console","log","status","fail","exception","grid","plusBtn","popup","dateInput","valueInput","saveBtn","addEventListener","e","rect","getBoundingClientRect","containerRect","position","left","scrollLeft","top","display","valueAsDate","Date","rating","isNaN","alert","div","createElement","className","title","insertBefore","contains","target","on","data","loadExistingData"],"mappings":"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"}