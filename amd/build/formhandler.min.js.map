{"version":3,"file":"formhandler.min.js","sources":["../src/formhandler.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n    return {\n        init: function(params) {\n            const levelColors = {\n                \"Not Started\": \"#f8d7da\",\n                \"Fresh\": \"#fce5cd\",\n                \"Learning\": \"#fff3cd\",\n                \"Expert\": \"#d1ecf1\",\n                \"Done\": \"#d4edda\"\n            };\n\n            function updateLevelColor() {\n                const levelSelect = document.getElementById('learninglevel');\n                const selectedLevel = levelSelect?.value;\n                if (selectedLevel && levelColors[selectedLevel]) {\n                    levelSelect.style.backgroundColor = levelColors[selectedLevel];\n                } else if (levelSelect) {\n                    levelSelect.style.backgroundColor = 'white';\n                }\n            }\n\n            function updateProgressBar() {\n                const revisionInput = document.getElementById('revisioncount');\n                const targetInput = document.getElementById('targetcount');\n                const progressBar = document.getElementById('progressBar');\n\n                const revisioncount = parseInt(revisionInput?.value || 0);\n                const targetcount = parseInt(targetInput?.value || 1);\n                const percent = Math.min(100, Math.round((revisioncount / targetcount) * 100));\n                if (progressBar) {\n                    progressBar.style.width = percent + '%';\n                    progressBar.textContent = percent + '%';\n                }\n            }\n\n            function saveData() {\n                var date = $('#nextReview').val();\n                const learninglevel = $('#learninglevel').val();\n                const revisioncount = $('#revisioncount').val();\n                const targetcount = $('#targetcount').val();\n                const pageurl = window.location.pathname + window.location.search;\n\n                if (!date) {\n                    date = '';\n                    //window.console.log(\"date cleared. TODO: Update when to delete page row from the table\");\n                }\n                Ajax.call([{\n                    methodname: 'block_revisionmanager_save_entry',\n                    args: {\n                        nextreview: date,\n                        pageurl: pageurl,\n                        courseid: params.courseid,\n                        pagetitle: params.pagetitle,\n                        learninglevel: learninglevel,\n                        revisioncount: revisioncount,\n                        targetcount: targetcount,\n                    },\n                    done: function(response) {\n                        console.log('Saved:', response.status);\n                    },\n                    fail: Notification.exception\n                }]);\n                \n            }\n\n            function loadExistingData() {\n                const pageurl = window.location.pathname + window.location.search;\n\n                Ajax.call([{\n                    methodname: 'block_revisionmanager_get_entry',\n                    args: { \n                        pageurl: pageurl,\n                        courseid: params.courseid\n                    },\n                    done: function(data) {\n                        if (data.nextreview) {\n                            $('#nextReview').val(data.nextreview);\n                        }\n                        if (data.learninglevel) {\n                            $('#learninglevel').val(data.learninglevel);\n                            updateLevelColor();\n                        }\n                        if (data.revisioncount) {\n                            $('#revisioncount').val(data.revisioncount);\n                        }\n                        if (data.targetcount) {\n                            $('#targetcount').val(data.targetcount);\n                        }\n                        updateProgressBar();\n                    },\n                    fail: Notification.exception\n                }]);\n            }\n\n            // Attach listeners for autosave\n            $('#nextReview').on('input change', saveData);\n            $('#learninglevel').on('input change', function() {\n                updateLevelColor();\n                saveData();\n            });\n            $('#revisioncount').on('input change', function() {\n                updateProgressBar();\n                saveData();\n            });\n            $('#targetcount').on('input change', function() {\n                updateProgressBar();\n                saveData();\n            });\n\n            // Initial setup\n            updateLevelColor();\n            updateProgressBar();\n            loadExistingData();\n        }\n    };\n});\n"],"names":["define","$","Ajax","Notification","init","params","levelColors","updateLevelColor","levelSelect","document","getElementById","selectedLevel","value","style","backgroundColor","updateProgressBar","revisionInput","targetInput","progressBar","revisioncount","parseInt","targetcount","percent","Math","min","round","width","textContent","saveData","date","val","learninglevel","pageurl","window","location","pathname","search","call","methodname","args","nextreview","courseid","pagetitle","done","response","console","log","status","fail","exception","on","data","loadExistingData"],"mappings":"AAAAA,2CAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,oBAC5D,CACHC,KAAM,SAASC,cACLC,YAAc,eACD,gBACN,mBACG,iBACF,eACF,oBAGHC,yBACCC,YAAcC,SAASC,eAAe,iBACtCC,cAAgBH,MAAAA,mBAAAA,YAAaI,MAC/BD,eAAiBL,YAAYK,eAC7BH,YAAYK,MAAMC,gBAAkBR,YAAYK,eACzCH,cACPA,YAAYK,MAAMC,gBAAkB,kBAInCC,0BACCC,cAAgBP,SAASC,eAAe,iBACxCO,YAAcR,SAASC,eAAe,eACtCQ,YAAcT,SAASC,eAAe,eAEtCS,cAAgBC,UAASJ,MAAAA,qBAAAA,cAAeJ,QAAS,GACjDS,YAAcD,UAASH,MAAAA,mBAAAA,YAAaL,QAAS,GAC7CU,QAAUC,KAAKC,IAAI,IAAKD,KAAKE,MAAON,cAAgBE,YAAe,MACrEH,cACAA,YAAYL,MAAMa,MAAQJ,QAAU,IACpCJ,YAAYS,YAAcL,QAAU,cAInCM,eACDC,KAAO5B,EAAE,eAAe6B,YACtBC,cAAgB9B,EAAE,kBAAkB6B,MACpCX,cAAgBlB,EAAE,kBAAkB6B,MACpCT,YAAcpB,EAAE,gBAAgB6B,MAChCE,QAAUC,OAAOC,SAASC,SAAWF,OAAOC,SAASE,OAEtDP,OACDA,KAAO,IAGX3B,KAAKmC,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFC,WAAYX,KACZG,QAASA,QACTS,SAAUpC,OAAOoC,SACjBC,UAAWrC,OAAOqC,UAClBX,cAAeA,cACfZ,cAAeA,cACfE,YAAaA,aAEjBsB,KAAM,SAASC,UACXC,QAAQC,IAAI,SAAUF,SAASG,SAEnCC,KAAM7C,aAAa8C,aAmC3BhD,EAAE,eAAeiD,GAAG,eAAgBtB,UACpC3B,EAAE,kBAAkBiD,GAAG,gBAAgB,WACnC3C,mBACAqB,cAEJ3B,EAAE,kBAAkBiD,GAAG,gBAAgB,WACnCnC,oBACAa,cAEJ3B,EAAE,gBAAgBiD,GAAG,gBAAgB,WACjCnC,oBACAa,cAIJrB,mBACAQ,qCA7CUiB,QAAUC,OAAOC,SAASC,SAAWF,OAAOC,SAASE,OAE3DlC,KAAKmC,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CACFP,QAASA,QACTS,SAAUpC,OAAOoC,UAErBE,KAAM,SAASQ,MACPA,KAAKX,YACLvC,EAAE,eAAe6B,IAAIqB,KAAKX,YAE1BW,KAAKpB,gBACL9B,EAAE,kBAAkB6B,IAAIqB,KAAKpB,eAC7BxB,oBAEA4C,KAAKhC,eACLlB,EAAE,kBAAkB6B,IAAIqB,KAAKhC,eAE7BgC,KAAK9B,aACLpB,EAAE,gBAAgB6B,IAAIqB,KAAK9B,aAE/BN,qBAEJiC,KAAM7C,aAAa8C,aAsB3BG"}