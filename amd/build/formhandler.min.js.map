{"version":3,"file":"formhandler.min.js","sources":["../src/formhandler.js"],"sourcesContent":["define(['jquery', 'core/ajax', 'core/notification'], function($, Ajax, Notification) {\n    return {\n        init: function(params) {\n            function saveData() {\n                const date = $('#nextReview').val();\n                const learninglevel = $('#learninglevel').val();\n                const revisioncount = $('#revisioncount').val();\n                const targetcount = $('#targetcount').val();\n                const pageurl = window.location.pathname + window.location.search;\n\n                if (!date) {\n                    // Call delete endpoint when date is cleared\n                    window.console.log(\"date cleared. TODO: Update when to delete page row from the table\");\n                    // Ajax.call([{\n                    //     methodname: 'block_revisionmanager_delete_entry',\n                    //     args: {\n                    //         pageurl: pageurl,\n                    //         courseid: params.courseid\n                    //     },\n                    //     done: function(response) {\n                    //         console.log('Entry deleted:', response.status);\n                    //     },\n                    //     fail: Notification.exception\n                    // }]);\n                } else {\n                    // Save date normally\n                    Ajax.call([{\n                        methodname: 'block_revisionmanager_save_entry',\n                        args: {\n                            nextreview: date,\n                            pageurl: pageurl,\n                            courseid: params.courseid,\n                            pagetitle: params.pagetitle,\n                            learninglevel: learninglevel,\n                            revisioncount: revisioncount,\n                            targetcount: targetcount,\n                        },\n                        done: function(response) {\n                            console.log('Saved:', response.status);\n                        },\n                        fail: Notification.exception\n                    }]);\n                }\n            }\n\n            function loadExistingData() {\n                const pageurl = window.location.pathname + window.location.search;\n\n                Ajax.call([{\n                    methodname: 'block_revisionmanager_get_entry',\n                    args: { \n                        pageurl: pageurl,\n                        courseid: params.courseid\n                     },\n                    done: function(data) {\n                        if (data.nextreview) {\n                            $('#nextReview').val(data.nextreview);\n                        }\n                        if (data.learninglevel) {\n                            $('#learninglevel').val(data.learninglevel);\n                        }\n                        if (data.revisioncount) {\n                            $('#revisioncount').val(data.revisioncount);\n                        }\n                        if (data.targetcount) {\n                            $('#targetcount').val(data.targetcount);\n                        }\n\n                    },\n                    fail: Notification.exception\n                }]);\n            }\n\n            // Attach listeners for autosave\n            $('#nextReview').on('input change', saveData);\n            $('#learninglevel').on('input change', saveData);\n            $('#revisioncount').on('input change', saveData);\n            $('#targetcount').on('input change', saveData);\n            loadExistingData();\n        }\n    };\n});"],"names":["define","$","Ajax","Notification","init","params","saveData","date","val","learninglevel","revisioncount","targetcount","pageurl","window","location","pathname","search","call","methodname","args","nextreview","courseid","pagetitle","done","response","console","log","status","fail","exception","on","data","loadExistingData"],"mappings":"AAAAA,2CAAO,CAAC,SAAU,YAAa,sBAAsB,SAASC,EAAGC,KAAMC,oBAC5D,CACHC,KAAM,SAASC,iBACFC,iBACCC,KAAON,EAAE,eAAeO,MACxBC,cAAgBR,EAAE,kBAAkBO,MACpCE,cAAgBT,EAAE,kBAAkBO,MACpCG,YAAcV,EAAE,gBAAgBO,MAChCI,QAAUC,OAAOC,SAASC,SAAWF,OAAOC,SAASE,OAEtDT,KAgBDL,KAAKe,KAAK,CAAC,CACPC,WAAY,mCACZC,KAAM,CACFC,WAAYb,KACZK,QAASA,QACTS,SAAUhB,OAAOgB,SACjBC,UAAWjB,OAAOiB,UAClBb,cAAeA,cACfC,cAAeA,cACfC,YAAaA,aAEjBY,KAAM,SAASC,UACXC,QAAQC,IAAI,SAAUF,SAASG,SAEnCC,KAAMzB,aAAa0B,aA5BvBhB,OAAOY,QAAQC,IAAI,qEA8D3BzB,EAAE,eAAe6B,GAAG,eAAgBxB,UACpCL,EAAE,kBAAkB6B,GAAG,eAAgBxB,UACvCL,EAAE,kBAAkB6B,GAAG,eAAgBxB,UACvCL,EAAE,gBAAgB6B,GAAG,eAAgBxB,2BA/B3BM,QAAUC,OAAOC,SAASC,SAAWF,OAAOC,SAASE,OAE3Dd,KAAKe,KAAK,CAAC,CACPC,WAAY,kCACZC,KAAM,CACFP,QAASA,QACTS,SAAUhB,OAAOgB,UAErBE,KAAM,SAASQ,MACPA,KAAKX,YACLnB,EAAE,eAAeO,IAAIuB,KAAKX,YAE1BW,KAAKtB,eACLR,EAAE,kBAAkBO,IAAIuB,KAAKtB,eAE7BsB,KAAKrB,eACLT,EAAE,kBAAkBO,IAAIuB,KAAKrB,eAE7BqB,KAAKpB,aACLV,EAAE,gBAAgBO,IAAIuB,KAAKpB,cAInCiB,KAAMzB,aAAa0B,aAS3BG"}