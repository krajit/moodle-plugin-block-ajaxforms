define("block_revisionmanager/formhandler",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{init:function(params){const levelColors={"Not Started":"#f8d7da",Fresh:"#fce5cd",Learning:"#fff3cd",Expert:"#d1ecf1",Done:"#d4edda"};function updateLevelColor(){const levelSelect=document.getElementById("learninglevel"),selectedLevel=null==levelSelect?void 0:levelSelect.value;selectedLevel&&levelColors[selectedLevel]?levelSelect.style.backgroundColor=levelColors[selectedLevel]:levelSelect&&(levelSelect.style.backgroundColor="white")}function updateProgressBar(){const revisionInput=document.getElementById("revisioncount"),targetInput=document.getElementById("targetcount"),progressBar=document.getElementById("progressBar"),revisioncount=parseInt((null==revisionInput?void 0:revisionInput.value)||0),targetcount=parseInt((null==targetInput?void 0:targetInput.value)||1),percent=Math.min(100,Math.round(revisioncount/targetcount*100));progressBar&&(progressBar.style.width=percent+"%",progressBar.textContent=percent+"%")}function saveData(){var date=$("#nextReview").val();const learninglevel=$("#learninglevel").val(),revisioncount=$("#revisioncount").val(),targetcount=$("#targetcount").val(),pageurl=window.location.pathname+window.location.search;date||(date=""),Ajax.call([{methodname:"block_revisionmanager_save_entry",args:{nextreview:date,pageurl:pageurl,courseid:params.courseid,pagetitle:params.pagetitle,learninglevel:learninglevel,revisioncount:revisioncount,targetcount:targetcount},done:function(response){console.log("Saved:",response.status)},fail:Notification.exception}])}$("#nextReview").on("input change",saveData),$("#learninglevel").on("input change",(function(){updateLevelColor(),saveData()})),$("#revisioncount").on("input change",(function(){updateProgressBar(),saveData()})),$("#targetcount").on("input change",(function(){updateProgressBar(),saveData()})),updateLevelColor(),updateProgressBar(),function(){const pageurl=window.location.pathname+window.location.search;Ajax.call([{methodname:"block_revisionmanager_get_entry",args:{pageurl:pageurl,courseid:params.courseid},done:function(data){data.nextreview&&$("#nextReview").val(data.nextreview),data.learninglevel&&($("#learninglevel").val(data.learninglevel),updateLevelColor()),data.revisioncount&&$("#revisioncount").val(data.revisioncount),data.targetcount&&$("#targetcount").val(data.targetcount),updateProgressBar()},fail:Notification.exception}])}(),function(){const container=document.getElementById("rating-container"),popup=document.getElementById("rating-popup"),dateInput=document.getElementById("rating-date"),valueInput=document.getElementById("rating-value"),saveBtn=document.getElementById("rating-save");let currentButton=null;container.querySelectorAll(".rating-btn").forEach((button=>{button.addEventListener("click",(function(e){currentButton=this,valueInput.value=this.dataset.rating,dateInput.value=this.dataset.date||(new Date).toISOString().split("T")[0];const rect=this.getBoundingClientRect(),containerRect=container.getBoundingClientRect();popup.style.position="absolute",popup.style.left="".concat(rect.left-containerRect.left,"px"),popup.style.top="".concat(rect.top-containerRect.top+45,"px"),popup.style.display="block"}))})),saveBtn.addEventListener("click",(function(){if(currentButton){const newRating=valueInput.value,newDate=dateInput.value;currentButton.textContent=newRating,currentButton.dataset.rating=newRating,currentButton.dataset.date=newDate,popup.style.display="none",currentButton.classList.remove("bg-danger","bg-warning","bg-success","bg-orange","bg-lightgreen");let rating=parseInt(newRating);1===rating?currentButton.classList.add("bg-danger","text-white"):2===rating?currentButton.classList.add("bg-orange","text-white"):3===rating?currentButton.classList.add("bg-warning","text-dark"):4===rating?currentButton.classList.add("bg-lightgreen","text-white"):5===rating&&currentButton.classList.add("bg-success","text-white"),console.log("Saved: ".concat(newRating," on ").concat(newDate))}})),document.addEventListener("click",(function(e){popup.contains(e.target)||e.target.classList.contains("rating-btn")||(popup.style.display="none")}))}()}}}));

//# sourceMappingURL=formhandler.min.js.map