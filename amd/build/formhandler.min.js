define("block_revisionmanager/formhandler",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{init:function(params){const levelColors={"Not Started":"#f8d7da",Fresh:"#fce5cd",Learning:"#fff3cd",Expert:"#d1ecf1",Done:"#d4edda"};function updateLevelColor(){const levelSelect=document.getElementById("learninglevel"),selectedLevel=null==levelSelect?void 0:levelSelect.value;selectedLevel&&levelColors[selectedLevel]?levelSelect.style.backgroundColor=levelColors[selectedLevel]:levelSelect&&(levelSelect.style.backgroundColor="white")}function updateProgressBar(){const revisionInput=document.getElementById("revisioncount"),targetInput=document.getElementById("targetcount"),progressBar=document.getElementById("progressBar"),revisioncount=parseInt((null==revisionInput?void 0:revisionInput.value)||0),targetcount=parseInt((null==targetInput?void 0:targetInput.value)||1),percent=Math.min(100,Math.round(revisioncount/targetcount*100));progressBar&&(progressBar.style.width=percent+"%",progressBar.textContent=percent+"%")}function saveData(){var date=$("#nextReview").val();const learninglevel=$("#learninglevel").val(),revisioncount=$("#revisioncount").val(),targetcount=$("#targetcount").val(),pageurl=window.location.pathname+window.location.search;date||(date=""),Ajax.call([{methodname:"block_revisionmanager_save_entry",args:{nextreview:date,pageurl:pageurl,courseid:params.courseid,pagetitle:params.pagetitle,learninglevel:learninglevel,revisioncount:revisioncount,targetcount:targetcount},done:function(response){console.log("Saved:",response.status)},fail:Notification.exception}])}const grid=document.getElementById("rating-grid"),plusBtn=document.getElementById("plusBtn"),popup=document.getElementById("rating-popup"),dateInput=document.getElementById("rating-date"),valueInput=document.getElementById("rating-value"),saveBtn=document.getElementById("rating-save");null==plusBtn||plusBtn.addEventListener("click",(e=>{const rect=plusBtn.getBoundingClientRect(),containerRect=grid.getBoundingClientRect();popup.style.position="absolute",popup.style.left="".concat(rect.left-containerRect.left+grid.scrollLeft,"px"),popup.style.top="".concat(rect.top-containerRect.top+45,"px"),popup.style.display="block",dateInput.valueAsDate=new Date,valueInput.value=""})),null==saveBtn||saveBtn.addEventListener("click",(()=>{const rating=parseInt(valueInput.value),date=dateInput.value;if(isNaN(rating)||rating<0||rating>5)return void alert("Please enter a rating between 0 and 5");const div=document.createElement("div");div.className="rating-square bg-rating-".concat(rating),div.textContent=rating,div.title="Date: ".concat(date),grid.insertBefore(div,plusBtn),popup.style.display="none",console.log("Saved rating:",rating,"on",date)})),document.addEventListener("click",(e=>{popup.contains(e.target)||e.target===plusBtn||(popup.style.display="none")})),$("#nextReview").on("input change",saveData),$("#learninglevel").on("input change",(function(){updateLevelColor(),saveData()})),$("#revisioncount").on("input change",(function(){updateProgressBar(),saveData()})),$("#targetcount").on("input change",(function(){updateProgressBar(),saveData()})),updateLevelColor(),updateProgressBar(),function(){const pageurl=window.location.pathname+window.location.search;Ajax.call([{methodname:"block_revisionmanager_get_entry",args:{pageurl:pageurl,courseid:params.courseid},done:function(data){data.nextreview&&$("#nextReview").val(data.nextreview),data.learninglevel&&($("#learninglevel").val(data.learninglevel),updateLevelColor()),data.revisioncount&&$("#revisioncount").val(data.revisioncount),data.targetcount&&$("#targetcount").val(data.targetcount),updateProgressBar()},fail:Notification.exception}])}()}}}));

//# sourceMappingURL=formhandler.min.js.map