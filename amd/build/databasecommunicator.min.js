define("block_revisionmanager/databasecommunicator",["jquery","core/ajax","core/notification"],(function($,Ajax,Notification){return{init:function(params){const grid=document.getElementById("rating-grid"),plusBtn=document.getElementById("plusBtn"),popup=document.getElementById("rating-popup"),dateInput=document.getElementById("rating-date"),valueInput=document.getElementById("rating-value"),saveBtn=document.getElementById("rating-save");null==plusBtn||plusBtn.addEventListener("click",(e=>{const rect=plusBtn.getBoundingClientRect(),containerRect=grid.getBoundingClientRect();popup.style.position="absolute",popup.style.left="".concat(rect.left-containerRect.left+grid.scrollLeft,"px"),popup.style.top="".concat(rect.top-containerRect.top+45,"px"),popup.style.display="block",dateInput.valueAsDate=new Date,valueInput.value=""})),null==saveBtn||saveBtn.addEventListener("click",(()=>{const rating=parseInt(valueInput.value),date=dateInput.value;var nextreview=$("#nextReview").val();const pageurl=window.location.pathname+window.location.search;if(isNaN(rating)||rating<0||rating>5)return void alert("Please enter a rating between 0 and 5");const timestamp=Math.floor(new Date(date).getTime()/1e3);Ajax.call([{methodname:"block_revisionmanager_save_rating",args:{courseid:params.courseid,pageid:params.pageid,ratingvalue:rating,ratingdate:timestamp,pageurl:pageurl,nextreview:nextreview,pagetitle:params.pagetitle,chapterid:params.chapterid},done:function(){const div=document.createElement("div");div.className="rating-square bg-rating-".concat(rating),div.textContent=rating,div.title="Date: ".concat(date),grid.insertBefore(div,plusBtn),popup.style.display="none"},fail:Notification.exception}])})),document.addEventListener("click",(e=>{popup.contains(e.target)||e.target===plusBtn||(popup.style.display="none")})),Ajax.call([{methodname:"block_revisionmanager_get_ratings",args:{courseid:params.courseid,pageid:params.pageid,chapterid:params.chapterid},done:function(ratings){ratings.forEach((r=>{const dateStr=new Date(1e3*r.ratingdate).toISOString().split("T")[0],div=document.createElement("div");div.className="rating-square bg-rating-".concat(r.ratingvalue),div.textContent=r.ratingvalue,div.title="Date: ".concat(dateStr),grid.insertBefore(div,plusBtn)}))},fail:Notification.exception}])}}}));

//# sourceMappingURL=databasecommunicator.min.js.map